define([
  "jquery",
  "core/modal_factory",
  "core/str",
  "core/modal_events",
  "core/ajax",
  "core/notification"
], function ($, ModalFactory, String, ModalEvents, Ajax, Notification) {
  var trigger = $('.local_notifi_delete_button');
  ModalFactory.create({
      type: ModalFactory.types.SAVE_CANCEL,
      title: String.get_string('delete_notifi'),
      body: String.get_string('delete_notifi_confirm'),
      preShowCallback: function (triggerElement, modal) {
          triggerElement = $(triggerElement);
          let notifiid = triggerElement.data('notifiid'); // Get the notification ID from data-notifiid attribute.
          modal.params = { 'id': notifiid }; // Set the correct parameter name 'id'.
          modal.setSaveButtonText(String.get_string('delete_notifi'));
      },
      large: true,
  }, trigger).done(function (modal) {
      modal.getRoot().on(ModalEvents.save, function (e) {
          e.preventDefault();
          let footer = Y.one('.modal-footer');
          footer.setContent('Deleting...');
          let spinner = M.util.add_spinner(Y, footer);
          spinner.show();
          let request = {
              methodname: 'local_notifi_delete_notifi',
              args: modal.params,
          };
          Ajax.call([request])[0].done(function (data) {
              if (data === true) {
                  window.location.reload();
              } else {
                  Notification.addNotification({
                      message: String.get_string('delete_notifi_failed'),
                      type: 'error',
                  });
              }
          }).fail(Notification.exception);
      });
  });
});
